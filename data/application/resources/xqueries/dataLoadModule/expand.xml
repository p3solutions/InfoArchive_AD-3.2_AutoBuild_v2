<xquery xmlns="http://www.emc.com/documentum/xml/dds">
    <expression><![CDATA[

	import module namespace appname = 'appname' at '/APPLICATIONS/changeme/appname/appname.xqy';

	declare variable $table as xs:string external;
	declare variable $date as xs:string external;
	declare variable $count as xs:string external;
	
	declare variable $path 		:= concat("/DATA/",$appname:pathname,"/Collection/LOAD/");
	declare variable $audPath 	:= concat("/DATA/",$appname:pathname,"/Collection/Audit/");

	declare function local:getDate($date){
		concat(substring($date,7),substring($date,1,2),substring($date,4,2))
	};

	let $set := for $i in doc($path)/LOAD/LOAD_ROW
				where 
					$i/@TABLE	= upper-case($table) and 
					$i/DATE		= local:getDate($date) and 
					$i/@STATUS 	= 'SUCCESS'
				return
					<result
						FILE 		= '{$i/FILE}'
						ROW_COUNT 	= '{$i/ROW_COUNT}'
					/>

	return
		<results 
			tablename 	= '{$table}' 
			date		= '{$date}' 
			totalcount	= '{$count}'
			
		>
		{
			($set) 
		}
		</results>	
]]></expression>
</xquery>